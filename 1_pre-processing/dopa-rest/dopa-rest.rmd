---
title: "Dopa REST Services"
author: "J Schielein, OP Bhandari"
date: "3/1/2021"
output: html_document
---
```{r, include=FALSE}
source("dopa-rest.R", local = knitr::knit_global())
# or sys.source("your-script.R", envir = knitr::knit_global())
library(knitr)
library(rmarkdown)
```

### Introduction

Digital Observatory for Protected Areas (DOPA) Explorer is an initiative from the Joint Research Centre (JRC), European Commission which is the web-based information system of the Protected Areas (PAs) providing information on the global level. DOPA has maintained huge datasets of the PAs and can be accessed through REST API. The script `dopa-rest.R` provides different functions to access the datasets in CSV format. 
<br />
<br />
The functions listed in the `dopa-rest.R` are:<br />
`redlist_status`, `redlist_list`, `wdpalevel_centroid`, `water_stats`, `all_indicators`, `landcover_change`,  `landcover_esa`,  `lcc_percent`,  `landcover_copernicus`, `normalizedind_country`, `normalizedind_ecoregion` and `get_dopa`.


### Data

1. `redlist_status` takes wdpaid as argument.<br /> 
    Returns statistics (counts species, by class, by IUCN categories) for species (Corals, Sharks & Rays, Amphibians,     Birds, Mammals) in Protected Area; calculated as intersection of species ranges with WDPA.
<br />
<br />
    Data source: IUCN Redlist <br />
    Spatial Coverage: Global <br />
    Spatial Resolution: 5 km <br />
    Temporal Coverage: 1964-2020 <br />
    Temporal Resolution: Biannual updates <br />
    [Metadata Link]("http://cmsdocs.s3.amazonaws.com/RedListGuidelines.pdf") 
<br />
<br />
      How to use the function? <br />
      - Pass the wdpaid of the protected area to generate statistics on species enlisted in IUCN redlist within it <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates species status' statistics for the PA with wdpaid 146 
paged_table(redlist_status(146))
```
<br />

2. `redlist_list` takes wdpaid as argument.<br /> 
    Returns list of species (Corals, Sharks & Rays, Amphibians, Birds, Mammals) in Protected Area; calculated as intersection of species ranges with WDPA.
<br />
<br />
    Data source: IUCN Redlist <br />
    Spatial Coverage: Global <br />
    Spatial Resolution: 5 km <br />
    Temporal Coverage: 1964-2020 <br />
    Temporal Resolution: Biannual updates <br />
    [Metadata Link]("http://cmsdocs.s3.amazonaws.com/RedListGuidelines.pdf")
<br />
<br />
    How to use the function? <br />
      - Pass the wdpaid of the protected area to generate list of available species enlisted in IUCN redlist within it <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates species lists for the PA with wdpaid 63645
paged_table(redlist_list(63645))
```
<br />

3. `wdpalevel_centroid` takes wdpaid as argument. <br />
    Calculates WDPA point coordinates (x,y) in EPSG 4326 (Lat Long WGS84) for points PAs real coords are shown. For polygon PAs centroids are calculated with the function ST_PointOnSurface, which returns a point guaranteed to lie on the surface.
<br />
<br />
    How to use the function? <br />
      - Pass the wdpaid of the protected area to generate it's point coordinates; for polygon to generate centroid coordinates <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates the point coordinates for the PA with wdpaid 555528898
paged_table(wdpalevel_centroid(555528898))
```
<br />

4. `water_stats` takes wdpaid as argument.<br /> 
    Returns information on the current surface area of permanent and seasonal water, and the net change over the period 1984-2015.
<br />
<br />
    Data source: Global Surface Water Explorer <br />
    Spatial Coverage:  Global <br />
    Spatial Resolution: 30 m <br />
    Temporal Coverage: 1984-2019 <br />
    Temporal Resolution: Perioic updates  <br />
    [Metadata Link]("https://storage.cloud.google.com/global-surface-water/downloads_ancillary/DataUsersGuidev2019.pdf")
<br />
<br />
    How to use the function? <br />
      - Pass the wdpaid of the protected area to generate the water statistics within it <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates the water statistics for the PA with wdpaid 671
paged_table(water_stats(671))
```
<br />

5. `all_indicators` takes wdpaid as argument.<br /> 
    Returns all indicators for Protected Areas.
<br />
<br />
    How to use the function? <br />
      - Pass the wdpaid of the area to generate all the possible indicators' values available within the PA <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates all the indicators available for the PA with wdpaid 142
paged_table(all_indicators(142))
```
<br />

6. `landcover_change` takes wdpaid as argument.<br /> 
    Returns absolute cover of ESA LC CCI classes (aggregated by level 1: 4 classes) which changed within first and last epoch i.e. 1995 & 2015 for a given WDPA.
<br />
<br />
    Data source: ESA CCI Land Cover <br />
    Spatial Coverage:  Global <br />
    Spatial Resolution: 300 m <br />
    Temporal Coverage: 1992-2015 <br />
    Temporal Resolution: Annual updates  <br />
    [Metadata Link]("http://maps.elie.ucl.ac.be/CCI/viewer/download/ESACCI-LC-Ph2-PUGv2_2.0.pdf")
<br />
<br />
    How to use the function? <br />
      - Pass the wdpaid of the area to generate landcover change statistics between 1995 & 2015 for that PA <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates the absolute landcover change of ESA Land Cover classes for the PA with wdpaid 32671 between 1995 & 2015
paged_table(landcover_change(32671))
```
<br />

7. `landcover_esa` takes wdpaid, year (1995,2000,2005,2010,2015), and aggregation level (0,1,2,3) as arguments.<br /> 
    Returns percentage and absolute cover of different ESA CCI LC classes for a given WDPA Aggregation levels 0 (original ESA LC classes), 1, 2 and 3 are available.
<br />
<br />
    Data source: ESA CCI Land Cover <br />
    Spatial Coverage:  Global <br />
    Spatial Resolution: 300 m <br />
    Temporal Coverage: 1992-2015 <br />
    Temporal Resolution: Annual updates  <br />
    [Metadata Link]("http://maps.elie.ucl.ac.be/CCI/viewer/download/ESACCI-LC-Ph2-PUGv2_2.0.pdf") 
<br />
<br />
    How to use the function? <br />
      - Pass the wdpaid of the area to generate ESA landcover statistics for that PA <br />
      - Pass the desired year
      - Pass the desired aggregation level
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates percentage and absolute cover of ESA Land Cover classes for the PA with wdpaid 32671 for the year 2015 and at 0 aggregation level
paged_table(landcover_esa(32671, 2015, 0))
```
<br />

8. `lcc_percent` takes wdpaid as argument.<br /> 
    Returns percentage and absolute cover of ESA LC CCI classes which changed within first and last epoch for a given WDPA.
<br />
<br />
    Data source: ESA CCI Land Cover <br />
    Spatial Coverage:  Global <br />
    Spatial Resolution: 300 m <br />
    Temporal Coverage: 1992-2015 <br />
    Temporal Resolution: Annual updates  <br />
    [Metadata Link]("http://maps.elie.ucl.ac.be/CCI/viewer/download/ESACCI-LC-Ph2-PUGv2_2.0.pdf") 
<br />
<br />
    How to use the function? <br />
      - Pass the wdpaid of the area to generate ESA landcover change percentage for that PA <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates percentage and absolute cover of ESA Land Cover classes which changed between 1995 & 2015 for the PA with wdpaid 32671
paged_table(lcc_percent(32671))
```
<br />

9. `landcover_copernicus` takes wdpaid and aggregation level (0,2) as arguments.<br /> 
    Returns percentage and absolute cover of Copernicus Land Cover classes for a given WDPA aggregation levels 0 (original Copernicus LC classes) and 2 (DOPA) are available.
<br />
<br />
    Data source: Copernicus Global Land Cover <br />
    Spatial Coverage:  Global <br />
    Spatial Resolution: 100 m <br />
    Temporal Coverage: 2015-2019 <br />
    Temporal Resolution: Annual updates  <br />
    [Metadata Link]("https://lcviewer.vito.be/about")
<br />
<br />
    How to use the function? <br />
      - Pass the wdpaid of the area to generate Copernicus landcover statistics for that PA <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates percentage and absolute cover of Copernicus Land Cover classes for the PA with wdpaid 32671 and 2 aggregation level
paged_table(landcover_copernicus(32671, 2))
```
<br />

10. `normalizedind_country` takes an indicator as argument, one among the listed many in `all_indicators`.<br /> 
    Returns, for protected area in country, absolute, normalized and average value of the selected indicator, and ranking within the country.
<br />
<br />
    How to use the function? <br />
      - Pass the indicator's name to generate the associated normalized values at the country level <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates normalized agriculture indicators at the country level
paged_table(normalizedind_country("agri_ind_pa"))
```
<br />

11. `normalizedind_ecoregion` takes an indicator as argument, one among the listed many in `all_indicators` and ecoregion id as arguments.<br /> 
    Returns, for protected area in ecoregion, absolute, normalized and average value of the selected indicator, and ranking within the ecoregion.
<br />
<br />
    How to use the function? <br />
      - Pass the indicator's name to generate the associated normalized values at the ecoregion level <br />
      - Pass the desired ecoregion id <br />
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates normalized agriculture indicators at the ecoregion level for the ecoregion with ecoregionid 16
paged_table(normalizedind_ecoregion("agri_ind_pa", 16))
```
<br />

12. `get_dopa` is a global function and takes topic, getQuery and wdpaid as arguments.<br /> 
    Topics include: "protected_sites", "species", "water", "landcover" <br /> 
    getQuery include "get_wdpa_level_centroid", "get_pa_water_stats", "get_pa_redlist_status", "get_pa_redlist_list", "get_wdpa_all_inds", "get_wdpa_lcc_esa", "get_wdpa_lcc_esa_percent"
    <br /> 
    Returns the desired variables in CSV format.
<br />
<br />
    How to use the function? <br />
      - Pass the topic's name associated with getQuery parameter <br />
      - Pass the desired getQuery parameter  <br />
      - Pass the wdpaid to generate variables within the desired PA
      - Example usage:<br />
      
```{r warning=FALSE}
#This code generates redlist status of species for the PA with wdpaid 146
paged_table(get_dopa("species", "get_pa_redlist_status", 146))
```
<br />

### Methods

```{r}

```


### References
