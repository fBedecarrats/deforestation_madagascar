<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Yota" />


<title>Panel creation</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/main/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">mapme.protectedareas</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/openkfw/mapme-protectedareas">
    <span class="fa fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Panel creation</h1>
<h4 class="author">Yota</h4>
<h4 class="date">28 3 2022</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2022-06-23
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 6 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 1
</p>
<p>
<strong>Knit directory:</strong> <code>mapme.protectedareas/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="https://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/workflowr/workflowr">workflowr</a> (version 1.7.0). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguncommittedchanges"> <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> <strong>R Markdown file:</strong> uncommitted changes </a>
</p>
</div>
<div id="strongRMarkdownfilestronguncommittedchanges" class="panel-collapse collapse">
<div class="panel-body">
<p>The R Markdown file has unstaged changes. To know which version of the R Markdown file created these results, you’ll want to first commit it to the Git repo. If you’re still working on the analysis, you can ignore this warning. When you’re finished, you can run <code>wflow_publish</code> to commit the R Markdown file and build the HTML.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20210305code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20210305)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20210305code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20210305)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomopenkfwmapmeprotectedareastree1dfb8aae4a51d8abccebf9dadb4ab0d85a476af9targetblank1dfb8aaa"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/openkfw/mapme.protectedareas/tree/1dfb8aae4a51d8abccebf9dadb4ab0d85a476af9" target="_blank">1dfb8aa</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomopenkfwmapmeprotectedareastree1dfb8aae4a51d8abccebf9dadb4ab0d85a476af9targetblank1dfb8aaa" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/openkfw/mapme.protectedareas/tree/1dfb8aae4a51d8abccebf9dadb4ab0d85a476af9" target="_blank">1dfb8aa</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .RData
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/

Unstaged changes:
    Modified:   analysis/analysis_02_createpanel.Rmd
    Modified:   analysis/analysis_03_regressions.Rmd
    Modified:   analysis/analysis_05_effect_illustration.Rmd

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/analysis_02_createpanel.Rmd</code>) and HTML (<code>docs/analysis_02_createpanel.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/012c427f54a1d6b0e7cdd8139b7c64ac3a40a1f6/analysis/analysis_02_createpanel.Rmd" target="_blank">012c427</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-06-13
</td>
<td>
draft first version to include BMZ disbursements on cell level
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/openkfw/mapme.protectedareas/6b2296a41ba4f06b792cdf7f4287013a607b51f2/docs/analysis_02_createpanel.html" target="_blank">6b2296a</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-06-13
</td>
<td>
output only
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/df49269c384662d5f5fee950bd56c34fed376b3e/analysis/analysis_02_createpanel.Rmd" target="_blank">df49269</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-06-07
</td>
<td>
minor adjustments
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/b3f32835772e7420d136baf2c8e39b81faf0cd46/analysis/analysis_02_createpanel.Rmd" target="_blank">b3f3283</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-06-07
</td>
<td>
small changes
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/39e054c25ef81b786deff99abb3d77dc08684989/analysis/analysis_02_createpanel.Rmd" target="_blank">39e054c</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-06-07
</td>
<td>
path changes
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/e406b0e53b14def915c53e63785edd4f36cca9d3/analysis/analysis_02_createpanel.Rmd" target="_blank">e406b0e</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-06-07
</td>
<td>
Add emissions variable in panel format
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/7c87eb38442797486a61bfa292ea28bfd4084587/analysis/analysis_02_createpanel.Rmd" target="_blank">7c87eb3</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-06-07
</td>
<td>
Include 2003 and 2017 in loops
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/cb3323cfa3c907643092840b266dfb16c1fb40be/analysis/analysis_02_createpanel.Rmd" target="_blank">cb3323c</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-06-03
</td>
<td>
adjust paths and include WDPAID für CEM matching frames
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/openkfw/mapme.protectedareas/cb3323cfa3c907643092840b266dfb16c1fb40be/docs/analysis_02_createpanel.html" target="_blank">cb3323c</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-06-03
</td>
<td>
adjust paths and include WDPAID für CEM matching frames
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/d5a23d6f24d7c877034749af310a41153ff41c69/analysis/analysis_02_createpanel.Rmd" target="_blank">d5a23d6</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-06-02
</td>
<td>
added wdpa ids to panels and changed paths in check data file
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/openkfw/mapme.protectedareas/756249aa52fa39c8282078c1376a5dc85dcba489/docs/analysis_02_createpanel.html" target="_blank">756249a</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-06-02
</td>
<td>
update analysis_01_matching.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/793b4841b926427bacd96395a7c0468275d47eb6/analysis/analysis_02_createpanel.Rmd" target="_blank">793b484</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-06-01
</td>
<td>
change colnames to faciliate long format conversion
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/acd62f68ad2a2c69838803167c91bab355210cc0/analysis/analysis_02_createpanel.Rmd" target="_blank">acd62f6</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-06-01
</td>
<td>
include new covariates in long format transformation
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/6dbed5811952caca6affd8919ef162500b1e1e0e/analysis/analysis_02_createpanel.Rmd" target="_blank">6dbed58</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-06-01
</td>
<td>
include new covariates
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/048db1b59421d4d05b1203f65fc514d441c9b606/analysis/analysis_02_createpanel.Rmd" target="_blank">048db1b</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-05-31
</td>
<td>
add covariates
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/1bec01ccc1966ef495ea8611d7cc6cf7027efa52/analysis/analysis_02_createpanel.Rmd" target="_blank">1bec01c</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-05-09
</td>
<td>
Updates for analysis files
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/openkfw/mapme.protectedareas/1bec01ccc1966ef495ea8611d7cc6cf7027efa52/docs/analysis_02_createpanel.html" target="_blank">1bec01c</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-05-09
</td>
<td>
Updates for analysis files
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/openkfw/mapme.protectedareas/bc91f00e84551c07cc60cc36a3db010826547cbe/docs/analysis_02_createpanel.html" target="_blank">bc91f00</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-05-06
</td>
<td>
resolve merging issue
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/openkfw/mapme.protectedareas/cb3dc6da8672af4be51dee1c6cc4362100072c21/docs/analysis_02_createpanel.html" target="_blank">cb3dc6d</a>
</td>
<td>
melvinhlwong
</td>
<td>
2022-05-06
</td>
<td>
update html
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/645e49746bc2abccb84fd9cc57282554cb30ad5a/analysis/analysis_02_createpanel.Rmd" target="_blank">645e497</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-04-04
</td>
<td>
New files, including new plots, tables and data source
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/openkfw/mapme.protectedareas/645e49746bc2abccb84fd9cc57282554cb30ad5a/docs/analysis_02_createpanel.html" target="_blank">645e497</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-04-04
</td>
<td>
New files, including new plots, tables and data source
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/b87b36680d55a7a124f3e930a77ff38ff82bd733/analysis/analysis_02_createpanel.Rmd" target="_blank">b87b366</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-03-28
</td>
<td>
updates
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/openkfw/mapme.protectedareas/blob/209294c28339408962bfb9ea63bc04460d389202/analysis/analysis_02_createpanel.Rmd" target="_blank">209294c</a>
</td>
<td>
Yota Eilers
</td>
<td>
2022-03-28
</td>
<td>
new analysis files
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<pre class="r"><code># clean workspace, set options
rm(list=ls())
options(scipen=999)

# get packages
lop &lt;- c(&quot;tidyverse&quot;, &quot;sf&quot;, &quot;units&quot;)
newp &lt;- lop[!(lop %in% installed.packages()[,&quot;Package&quot;])]
if(length(newp)) install.packages(newp)
lapply(lop, require, character.only = TRUE)</code></pre>
<pre><code>Loading required package: tidyverse</code></pre>
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>✔ ggplot2 3.3.4     ✔ purrr   0.3.4
✔ tibble  3.1.7     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.0
✔ readr   2.1.2     ✔ forcats 0.5.1</code></pre>
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre><code>Loading required package: sf</code></pre>
<pre><code>Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 7.0.0; sf_use_s2() is TRUE</code></pre>
<pre><code>Loading required package: units</code></pre>
<pre><code>udunits database from /usr/share/xml/udunits/udunits2.xml</code></pre>
<pre><code>[[1]]
[1] TRUE

[[2]]
[1] TRUE

[[3]]
[1] TRUE</code></pre>
<pre class="r"><code># Timer
start_time &lt;- Sys.time()

#------- Load and prepare fc data -------

# # Forest loss data
# fcl_supported_AND_nonPas &lt;-
#   read_csv(&quot;../../datalake/mapme.protectedareas/output/polygon/sampling/fishnets/dec_08/gfw/gfw_10km_all.csv&quot;)
# 
# # Select variables
# fcl_data &lt;- fcl_supported_AND_nonPas %&gt;% 
#   select(poly_id,id.x,treatment.x, starts_with(&quot;area&quot;), starts_with(&quot;loss&quot;))

# Forest loss data
fcl &lt;- read_rds(&quot;/datadrive/datalake/mapme.protectedareas/output/matching/matching_frames/full_database.rds&quot;) %&gt;%
  select(.assetid,
         starts_with(&quot;treecover&quot;),
         starts_with(&quot;loss&quot;),
         starts_with(&quot;emissions&quot;),
         starts_with(&quot;minprec&quot;),
         starts_with(&quot;maxprec&quot;),
         starts_with(&quot;wetness&quot;)) %&gt;%
  select(-starts_with(&quot;loss_t3&quot;),
         -starts_with(&quot;loss_tn&quot;))

# change variable names to facilitate long format conversion in code below
 colnames(fcl) &lt;-  sub(&quot;*_anomaly*&quot;, &quot;&quot;, colnames(fcl))
 colnames(fcl) &lt;-  sub(&quot;*_min*&quot;, &quot;&quot;, colnames(fcl))
 
##  Protected areas
wdpa_kfw&lt;-
  read_sf(&quot;~/shared/datalake/mapme.protectedareas/input/wdpa_kfw/wdpa_kfw_spatial_latinamerica_2021-02-01_supportedPAs_unique.gpkg&quot;)

# Load KfW finance data 
kfw_finance &lt;- 
  read_csv(&quot;~/shared/datalake/mapme.protectedareas/input/kfw_finance/mapme.protectedareas_kfw-finance-2021-03-17.csv&quot;) %&gt;% 
  filter(! is.na(bmz_nummer))</code></pre>
<pre><code>Rows: 42 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
dbl (4): bmz_nummer, first_year, last_year, total_disbursed

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>#Load wdpa bmz keys
keys_wdpaid_bmz &lt;- read_csv(&quot;~/shared/datalake/mapme.protectedareas/output/matching/model_frames/keys_wdpaid_bmz.csv&quot;) %&gt;% 
  rename(&quot;bmz_nummer&quot; = &quot;value&quot;)</code></pre>
<pre><code>Rows: 429 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: &quot;,&quot;
chr (1): name
dbl (2): WDPAID, value

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code># merge wdpa_kfw with keys
wdpa_kfw &lt;- left_join(wdpa_kfw, keys_wdpaid_bmz,
                      by=c(&quot;WDPAID&quot;))

#add kfw_finance data to wdpa_kfw
wdpa_kfw &lt;- left_join(wdpa_kfw, kfw_finance, 
                      by=c(&quot;bmz_nummer&quot;))

wdpa_year &lt;- wdpa_kfw %&gt;% 
  select(WDPAID, first_year) %&gt;% 
  st_drop_geometry
  
# Load link between assetid and WDPA ID
keys_assetid_wdpa &lt;- 
  read_sf(&quot;~/shared/datalake/mapme.protectedareas/processing/fishnet/honeycomb_5_sqkm_kfw.gpkg&quot;) %&gt;% 
  select(poly_id, WDPAID) %&gt;% 
  rename(&quot;.assetid&quot; = &quot;poly_id&quot;) %&gt;% 
  st_drop_geometry()
  
keys_assetid_wdpa &lt;- keys_assetid_wdpa %&gt;% 
  distinct(.assetid, WDPAID) %&gt;%  
  left_join(., wdpa_year,
            by=c(&quot;WDPAID&quot;)) %&gt;% 
  select(.assetid, WDPAID, first_year)</code></pre>
<pre class="r"><code>projectdata_database&lt;-
  read_csv(&quot;/datadrive/datalake/mapme.protectedareas/output/matching/model_frames/projectdata_supported.csv&quot;)

## reshape
projectdata_database_reshaped &lt;- projectdata_database %&gt;%
  gather(name, disbursement, 21:52) %&gt;%
  mutate(year = as.numeric(substr(name, 14,17))) %&gt;%
  select(-name)
## remove if BMZ==NA
projectdata_database_reshaped &lt;- as.data.frame(projectdata_database_reshaped[-which(is.na(projectdata_database_reshaped$bmz_nummer)),])
## aggregate by BMZ-year
project_agg &lt;- projectdata_database_reshaped %&gt;%
    dplyr::group_by(bmz_nummer, year, first_year) %&gt;% # check whether this makes sense
    dplyr::summarize(disbursement_proj = sum(disbursement))


## create treatment variable for disbursement
project_agg$treatment_disb_duringproj &lt;- ifelse(project_agg$disbursement_proj &gt; 0, 1, 0)


# merge WDPA with project data and UID
## load
keys_database &lt;-
  read_csv(&quot;../../datalake/mapme.protectedareas/output/matching/model_frames/keys_wdpaid_bmz.csv&quot;) %&gt;% 
  dplyr::rename(., bmz_nummer=value)

bmz_wdpa.df &lt;- merge(keys_database, project_agg,  by=c(&quot;bmz_nummer&quot;))


## load area data
keys_assetid_wdpa &lt;- 
  read_sf(&quot;~/shared/datalake/mapme.protectedareas/processing/fishnet/honeycomb_5_sqkm_kfw.gpkg&quot;) %&gt;% 
  select(poly_id, WDPAID) %&gt;% 
  rename(&quot;.assetid&quot; = &quot;poly_id&quot;) %&gt;% 
  mutate(area_km2=set_units(st_area(.), km^2))

bmz_wdpa.df&lt;-bmz_wdpa.df %&gt;% 
  left_join(.,st_drop_geometry(keys_assetid_wdpa),by=&quot;WDPAID&quot;)

## merge and calculate total BMZ project area
area.agg&lt;- bmz_wdpa.df %&gt;% 
  # st_drop_geometry() %&gt;% 
  filter(treatment_disb_duringproj==1) %&gt;% 
  group_by(year,bmz_nummer) %&gt;% 
  summarize(area_total=sum(area_km2))

# finance per total area  
bmz_wdpa.df&lt;-bmz_wdpa.df %&gt;% 
  left_join(.,area.agg,by=c(&quot;bmz_nummer&quot;,&quot;year&quot;))


bmz_wdpa.df$area_total[is.na(bmz_wdpa.df$area_total)==T]&lt;-0 # fill out NA in project area with 0.


bmz_wdpa.df$disbursement_sqkm &lt;-bmz_wdpa.df$disbursement_proj/bmz_wdpa.df$area_total # calculate disbursement per sqkm
bmz_wdpa.df$disbursement_5sqkmcell &lt;-bmz_wdpa.df$disbursement_proj/bmz_wdpa.df$area_total*bmz_wdpa.df$area_km2 # calculate disbursements per cell

## recode NaN as 0 (since we divided by 0)
bmz_wdpa.df$disbursement_sqkm [is.nan(bmz_wdpa.df$disbursement_sqkm )]&lt;-0
bmz_wdpa.df$disbursement_5sqkmcell [is.nan(bmz_wdpa.df$disbursement_5sqkmcell )]&lt;-0


## calculate disbursement in each cell by year
cell.agg&lt;- bmz_wdpa.df %&gt;% 
  group_by(.assetid, year) %&gt;% 
  summarize(cell_disb=sum(disbursement_5sqkmcell))</code></pre>
<div id="panelize-psm-data" class="section level2">
<h2>Panelize PSM data</h2>
<pre class="r"><code># Years with matching frames:
 T_year &lt;- c(2004:2017, 2019)
# T_year &lt;- c(2015)

for (i in T_year) {
    
    # prepare keys, keep keys only if corresponding WDPA-ID had project start in year i
    keys &lt;- keys_assetid_wdpa %&gt;%   
      filter(first_year == i)

    # Load matched data
    m_data &lt;-
      read_rds(paste0(&quot;/datadrive/datalake/mapme.protectedareas/output/tabular/regression_input/PSM/psm_matched_data_&quot;, i, &quot;.rds&quot;)) %&gt;%
      rename(&quot;m_treecover&quot; = &quot;treecover&quot;,
             &quot;m_loss&quot; = &quot;loss&quot;,
             &quot;m_loss_t3&quot; = &quot;loss_t3&quot;,
             &quot;m_emissions&quot; = &quot;emissions&quot;)
    # change variable names to facilitate long format conversion in code below
    colnames(m_data) &lt;-  sub(&quot;*_anomaly*&quot;, &quot;&quot;, colnames(m_data))
    colnames(m_data) &lt;-  sub(&quot;*_min*&quot;, &quot;&quot;, colnames(m_data))    
 
    # Merge matched data with 
    # merged_data &lt;- 
    #   left_join(m_data, fcl_data,
    #                          by=c(&quot;poly_id&quot;)) %&gt;% 
    #   pivot_longer(cols = c(starts_with(&quot;area&quot;) | starts_with(&quot;loss&quot;)),
    #                names_to = c(&quot;.value&quot;, &quot;year&quot;),
    #                names_sep = &quot;_&quot;) %&gt;% 
    #   select(-id.x, -treatment.x) %&gt;% 
    #   mutate(year_standard = as.numeric(year) - i) %&gt;% 
    #   rename(&quot;fc_area&quot; = &quot;area&quot;,
    #          &quot;fc_loss&quot; = &quot;loss&quot;)
    
    # Merge data with panel data, reshape to long, join with keys and drop if year is NA (year 2021 from wetness)
    merged_data &lt;- 
      left_join(m_data, fcl, by=c(&quot;.assetid&quot;)) %&gt;% 
      pivot_longer(cols = c(starts_with(&quot;treecover&quot;) | starts_with(&quot;loss&quot;) | starts_with(&quot;emissions&quot;) | starts_with(&quot;emissions&quot;) | starts_with(&quot;minprec&quot;) | starts_with(&quot;maxprec&quot;) | starts_with(&quot;wetness&quot;)),
                   names_to = c(&quot;.value&quot;, &quot;year&quot;),
                   names_sep = &quot;_&quot;) %&gt;% 
      mutate(year_standard = as.numeric(year) - i) %&gt;% 
      rename(&quot;fc_area&quot; = &quot;treecover&quot;,
             &quot;fc_loss&quot; = &quot;loss&quot;) %&gt;% 
      left_join(., keys,
                by=c(&quot;.assetid&quot;)) %&gt;%
      mutate(WDPAID = ifelse(treatment == 0, 9999999999, WDPAID)) %&gt;% 
      filter(! is.na(year)) %&gt;% # new line
      distinct(.assetid, year, .keep_all = TRUE) # adjust this as soon as we have a better solution
        
    ## Export data
    write_csv(merged_data,
              paste0(&quot;/datadrive/datalake/mapme.protectedareas/output/tabular/regression_input/PSM/psm_matched_panel_&quot;, i, &quot;.csv&quot;))

  
    # Check duplicates
    print(i)
    print(paste(&quot;Unique assetids in matched data:&quot;,
                (length(unique(m_data$.assetid)))
                ))
    print(paste(&quot;Unique assetids in matched data:&quot;,
                (length(unique(merged_data$.assetid)))
                ))
    print(&quot;Number of treated cells in matched data:&quot;)
    print(table(m_data$treatment))
    print(&quot;Number of treated cells in panel data:&quot;)
    print(table(subset(merged_data, treatment == 1)$year))
    
}</code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2004
[1] &quot;Unique assetids in matched data: 577&quot;
[1] &quot;Unique assetids in matched data: 577&quot;
[1] &quot;Number of treated cells in matched data:&quot;

  0   1 
281 296 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 296  296  296  296  296  296  296  296  296  296  296  296  296  296  296  296 
2016 2017 2018 2019 2020 
 296  296  296  296  296 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2005
[1] &quot;Unique assetids in matched data: 1855&quot;
[1] &quot;Unique assetids in matched data: 1855&quot;
[1] &quot;Number of treated cells in matched data:&quot;

  0   1 
917 938 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 938  938  938  938  938  938  938  938  938  938  938  938  938  938  938  938 
2016 2017 2018 2019 2020 
 938  938  938  938  938 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2006
[1] &quot;Unique assetids in matched data: 21369&quot;
[1] &quot;Unique assetids in matched data: 21369&quot;
[1] &quot;Number of treated cells in matched data:&quot;

    0     1 
 9506 11863 
[1] &quot;Number of treated cells in panel data:&quot;

 2000  2001  2002  2003  2004  2005  2006  2007  2008  2009  2010  2011  2012 
11863 11863 11863 11863 11863 11863 11863 11863 11863 11863 11863 11863 11863 
 2013  2014  2015  2016  2017  2018  2019  2020 
11863 11863 11863 11863 11863 11863 11863 11863 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2007
[1] &quot;Unique assetids in matched data: 40962&quot;
[1] &quot;Unique assetids in matched data: 40962&quot;
[1] &quot;Number of treated cells in matched data:&quot;

    0     1 
18116 22846 
[1] &quot;Number of treated cells in panel data:&quot;

 2000  2001  2002  2003  2004  2005  2006  2007  2008  2009  2010  2011  2012 
22846 22846 22846 22846 22846 22846 22846 22846 22846 22846 22846 22846 22846 
 2013  2014  2015  2016  2017  2018  2019  2020 
22846 22846 22846 22846 22846 22846 22846 22846 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2008
[1] &quot;Unique assetids in matched data: 18754&quot;
[1] &quot;Unique assetids in matched data: 18754&quot;
[1] &quot;Number of treated cells in matched data:&quot;

   0    1 
8888 9866 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
9866 9866 9866 9866 9866 9866 9866 9866 9866 9866 9866 9866 9866 9866 9866 9866 
2016 2017 2018 2019 2020 
9866 9866 9866 9866 9866 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2009
[1] &quot;Unique assetids in matched data: 959&quot;
[1] &quot;Unique assetids in matched data: 959&quot;
[1] &quot;Number of treated cells in matched data:&quot;

  0   1 
411 548 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 548  548  548  548  548  548  548  548  548  548  548  548  548  548  548  548 
2016 2017 2018 2019 2020 
 548  548  548  548  548 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2010
[1] &quot;Unique assetids in matched data: 3559&quot;
[1] &quot;Unique assetids in matched data: 3559&quot;
[1] &quot;Number of treated cells in matched data:&quot;

   0    1 
1766 1793 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
1793 1793 1793 1793 1793 1793 1793 1793 1793 1793 1793 1793 1793 1793 1793 1793 
2016 2017 2018 2019 2020 
1793 1793 1793 1793 1793 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2011
[1] &quot;Unique assetids in matched data: 6037&quot;
[1] &quot;Unique assetids in matched data: 6037&quot;
[1] &quot;Number of treated cells in matched data:&quot;

   0    1 
2867 3170 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
3170 3170 3170 3170 3170 3170 3170 3170 3170 3170 3170 3170 3170 3170 3170 3170 
2016 2017 2018 2019 2020 
3170 3170 3170 3170 3170 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2012
[1] &quot;Unique assetids in matched data: 22436&quot;
[1] &quot;Unique assetids in matched data: 22436&quot;
[1] &quot;Number of treated cells in matched data:&quot;

    0     1 
10758 11678 
[1] &quot;Number of treated cells in panel data:&quot;

 2000  2001  2002  2003  2004  2005  2006  2007  2008  2009  2010  2011  2012 
11678 11678 11678 11678 11678 11678 11678 11678 11678 11678 11678 11678 11678 
 2013  2014  2015  2016  2017  2018  2019  2020 
11678 11678 11678 11678 11678 11678 11678 11678 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2013
[1] &quot;Unique assetids in matched data: 875&quot;
[1] &quot;Unique assetids in matched data: 875&quot;
[1] &quot;Number of treated cells in matched data:&quot;

  0   1 
368 507 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 507  507  507  507  507  507  507  507  507  507  507  507  507  507  507  507 
2016 2017 2018 2019 2020 
 507  507  507  507  507 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2014
[1] &quot;Unique assetids in matched data: 247&quot;
[1] &quot;Unique assetids in matched data: 247&quot;
[1] &quot;Number of treated cells in matched data:&quot;

  0   1 
119 128 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 128  128  128  128  128  128  128  128  128  128  128  128  128  128  128  128 
2016 2017 2018 2019 2020 
 128  128  128  128  128 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2015
[1] &quot;Unique assetids in matched data: 196511&quot;
[1] &quot;Unique assetids in matched data: 196511&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
 71648 124863 
[1] &quot;Number of treated cells in panel data:&quot;

  2000   2001   2002   2003   2004   2005   2006   2007   2008   2009   2010 
124863 124863 124863 124863 124863 124863 124863 124863 124863 124863 124863 
  2011   2012   2013   2014   2015   2016   2017   2018   2019   2020 
124863 124863 124863 124863 124863 124863 124863 124863 124863 124863 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2016
[1] &quot;Unique assetids in matched data: 4991&quot;
[1] &quot;Unique assetids in matched data: 4991&quot;
[1] &quot;Number of treated cells in matched data:&quot;

   0    1 
2416 2575 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
2575 2575 2575 2575 2575 2575 2575 2575 2575 2575 2575 2575 2575 2575 2575 2575 
2016 2017 2018 2019 2020 
2575 2575 2575 2575 2575 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2017
[1] &quot;Unique assetids in matched data: 15472&quot;
[1] &quot;Unique assetids in matched data: 15472&quot;
[1] &quot;Number of treated cells in matched data:&quot;

   0    1 
7552 7920 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
7920 7920 7920 7920 7920 7920 7920 7920 7920 7920 7920 7920 7920 7920 7920 7920 
2016 2017 2018 2019 2020 
7920 7920 7920 7920 7920 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2019
[1] &quot;Unique assetids in matched data: 1989&quot;
[1] &quot;Unique assetids in matched data: 1989&quot;
[1] &quot;Number of treated cells in matched data:&quot;

   0    1 
 688 1301 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
1301 1301 1301 1301 1301 1301 1301 1301 1301 1301 1301 1301 1301 1301 1301 1301 
2016 2017 2018 2019 2020 
1301 1301 1301 1301 1301 </code></pre>
</div>
<div id="panelize-cem-data" class="section level2">
<h2>Panelize CEM data</h2>
<pre class="r"><code># Years with matching frames:
T_year &lt;- c(2004:2017, 2019)
# T_year &lt;- c(2015)
# T_year &lt;- c(2004:2014, 2016, 2019)

for (i in T_year) {
  
    # prepare keys, keep keys only if corresponding WDPA-ID had project start in year i
    keys &lt;- keys_assetid_wdpa %&gt;%   
      filter(first_year == i)
    
  
    # Load matched data
    m_data &lt;- 
        read_rds(paste0(&quot;/datadrive/datalake/mapme.protectedareas/output/tabular/regression_input/CEM/cem_matched_data_&quot;, i, &quot;.rds&quot;)) %&gt;%
      rename(&quot;m_treecover&quot; = &quot;treecover&quot;,
             &quot;m_loss&quot; = &quot;loss&quot;,
             &quot;m_loss_t3&quot; = &quot;loss_t3&quot;,
             &quot;m_emissions&quot; = &quot;emissions&quot;)
    # change variable names to facilitate long format conversion in code below
    colnames(m_data) &lt;-  sub(&quot;*_anomaly*&quot;, &quot;&quot;, colnames(m_data))
    colnames(m_data) &lt;-  sub(&quot;*_min*&quot;, &quot;&quot;, colnames(m_data))    
    
    # Merge matched data with 
    # merged_data &lt;- 
    #   left_join(m_data, fcl_data,
    #             by=c(&quot;poly_id&quot;)) %&gt;% 
    #   pivot_longer(cols = c(starts_with(&quot;area&quot;) | starts_with(&quot;loss&quot;)),
    #                names_to = c(&quot;.value&quot;, &quot;year&quot;),
    #                names_sep = &quot;_&quot;) %&gt;% 
    #   select(-id.x, -treatment.x) %&gt;% 
    #   mutate(year_standard = as.numeric(year) - i) %&gt;% 
    #   rename(&quot;fc_area&quot; = &quot;area&quot;,
    #          &quot;fc_loss&quot; = &quot;loss&quot;)
    
    # Merge data with panel data, reshape to long, join with keys and drop if year is NA (year 2021 from wetness)
    merged_data &lt;- 
      left_join(m_data, fcl,
                             by=c(&quot;.assetid&quot;)) %&gt;% 
      pivot_longer(cols = c(starts_with(&quot;treecover&quot;) | starts_with(&quot;loss&quot;) | starts_with(&quot;emissions&quot;) | starts_with(&quot;emissions&quot;) | starts_with(&quot;minprec&quot;) | starts_with(&quot;maxprec&quot;) | starts_with(&quot;wetness&quot;)),
                   names_to = c(&quot;.value&quot;, &quot;year&quot;),
                   names_sep = &quot;_&quot;) %&gt;% 
      mutate(year_standard = as.numeric(year) - i) %&gt;% 
      rename(&quot;fc_area&quot; = &quot;treecover&quot;,
             &quot;fc_loss&quot; = &quot;loss&quot;) %&gt;% 
      left_join(., keys,
                by=c(&quot;.assetid&quot;)) %&gt;%
      mutate(WDPAID = ifelse(treatment == 0, 9999999999, WDPAID)) %&gt;% 
      filter(! is.na(year)) %&gt;% # new line
      distinct(.assetid, year, .keep_all = TRUE) # adjust this as soon as we have a better solution # new line
    
    ## Export data
    write_csv(merged_data, 
              paste0(&quot;/datadrive/datalake/mapme.protectedareas/output/tabular/regression_input/CEM/cem_matched_panel_&quot;, i, &quot;.csv&quot;))
    
    # Check duplicates
    print(i)
    print(paste(&quot;Unique assetids in matched data:&quot;,
                (length(unique(m_data$.assetid)))
                ))
    print(paste(&quot;Unique assetids in matched data:&quot;,
                (length(unique(merged_data$.assetid)))
                ))
    print(&quot;Number of treated cells in matched data:&quot;)
    print(table(m_data$treatment))
    print(&quot;Number of treated cells in panel data:&quot;)
    print(table(subset(merged_data, treatment == 1)$year))
    
    
}</code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2004
[1] &quot;Unique assetids in matched data: 232846&quot;
[1] &quot;Unique assetids in matched data: 232846&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
232546    300 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 300  300  300  300  300  300  300  300  300  300  300  300  300  300  300  300 
2016 2017 2018 2019 2020 
 300  300  300  300  300 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2005
[1] &quot;Unique assetids in matched data: 273763&quot;
[1] &quot;Unique assetids in matched data: 273763&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
272830    933 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 933  933  933  933  933  933  933  933  933  933  933  933  933  933  933  933 
2016 2017 2018 2019 2020 
 933  933  933  933  933 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2006
[1] &quot;Unique assetids in matched data: 150693&quot;
[1] &quot;Unique assetids in matched data: 150693&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
139295  11398 
[1] &quot;Number of treated cells in panel data:&quot;

 2000  2001  2002  2003  2004  2005  2006  2007  2008  2009  2010  2011  2012 
11398 11398 11398 11398 11398 11398 11398 11398 11398 11398 11398 11398 11398 
 2013  2014  2015  2016  2017  2018  2019  2020 
11398 11398 11398 11398 11398 11398 11398 11398 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2007
[1] &quot;Unique assetids in matched data: 646855&quot;
[1] &quot;Unique assetids in matched data: 646855&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
624993  21862 
[1] &quot;Number of treated cells in panel data:&quot;

 2000  2001  2002  2003  2004  2005  2006  2007  2008  2009  2010  2011  2012 
21862 21862 21862 21862 21862 21862 21862 21862 21862 21862 21862 21862 21862 
 2013  2014  2015  2016  2017  2018  2019  2020 
21862 21862 21862 21862 21862 21862 21862 21862 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2008
[1] &quot;Unique assetids in matched data: 260122&quot;
[1] &quot;Unique assetids in matched data: 260122&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
251088   9034 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
9034 9034 9034 9034 9034 9034 9034 9034 9034 9034 9034 9034 9034 9034 9034 9034 
2016 2017 2018 2019 2020 
9034 9034 9034 9034 9034 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2009
[1] &quot;Unique assetids in matched data: 14300&quot;
[1] &quot;Unique assetids in matched data: 14300&quot;
[1] &quot;Number of treated cells in matched data:&quot;

    0     1 
13782   518 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 518  518  518  518  518  518  518  518  518  518  518  518  518  518  518  518 
2016 2017 2018 2019 2020 
 518  518  518  518  518 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2010
[1] &quot;Unique assetids in matched data: 86120&quot;
[1] &quot;Unique assetids in matched data: 86120&quot;
[1] &quot;Number of treated cells in matched data:&quot;

    0     1 
84382  1738 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
1738 1738 1738 1738 1738 1738 1738 1738 1738 1738 1738 1738 1738 1738 1738 1738 
2016 2017 2018 2019 2020 
1738 1738 1738 1738 1738 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2011
[1] &quot;Unique assetids in matched data: 68951&quot;
[1] &quot;Unique assetids in matched data: 68951&quot;
[1] &quot;Number of treated cells in matched data:&quot;

    0     1 
65944  3007 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
3007 3007 3007 3007 3007 3007 3007 3007 3007 3007 3007 3007 3007 3007 3007 3007 
2016 2017 2018 2019 2020 
3007 3007 3007 3007 3007 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2012
[1] &quot;Unique assetids in matched data: 328813&quot;
[1] &quot;Unique assetids in matched data: 328813&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
317415  11398 
[1] &quot;Number of treated cells in panel data:&quot;

 2000  2001  2002  2003  2004  2005  2006  2007  2008  2009  2010  2011  2012 
11398 11398 11398 11398 11398 11398 11398 11398 11398 11398 11398 11398 11398 
 2013  2014  2015  2016  2017  2018  2019  2020 
11398 11398 11398 11398 11398 11398 11398 11398 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2013
[1] &quot;Unique assetids in matched data: 64632&quot;
[1] &quot;Unique assetids in matched data: 64632&quot;
[1] &quot;Number of treated cells in matched data:&quot;

    0     1 
64154   478 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 478  478  478  478  478  478  478  478  478  478  478  478  478  478  478  478 
2016 2017 2018 2019 2020 
 478  478  478  478  478 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2014
[1] &quot;Unique assetids in matched data: 52058&quot;
[1] &quot;Unique assetids in matched data: 52058&quot;
[1] &quot;Number of treated cells in matched data:&quot;

    0     1 
51930   128 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 128  128  128  128  128  128  128  128  128  128  128  128  128  128  128  128 
2016 2017 2018 2019 2020 
 128  128  128  128  128 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2015
[1] &quot;Unique assetids in matched data: 994259&quot;
[1] &quot;Unique assetids in matched data: 994259&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
871826 122433 
[1] &quot;Number of treated cells in panel data:&quot;

  2000   2001   2002   2003   2004   2005   2006   2007   2008   2009   2010 
122433 122433 122433 122433 122433 122433 122433 122433 122433 122433 122433 
  2011   2012   2013   2014   2015   2016   2017   2018   2019   2020 
122433 122433 122433 122433 122433 122433 122433 122433 122433 122433 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2016
[1] &quot;Unique assetids in matched data: 603159&quot;
[1] &quot;Unique assetids in matched data: 603159&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
600588   2571 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
2571 2571 2571 2571 2571 2571 2571 2571 2571 2571 2571 2571 2571 2571 2571 2571 
2016 2017 2018 2019 2020 
2571 2571 2571 2571 2571 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2017
[1] &quot;Unique assetids in matched data: 245294&quot;
[1] &quot;Unique assetids in matched data: 245294&quot;
[1] &quot;Number of treated cells in matched data:&quot;

     0      1 
237419   7875 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
7875 7875 7875 7875 7875 7875 7875 7875 7875 7875 7875 7875 7875 7875 7875 7875 
2016 2017 2018 2019 2020 
7875 7875 7875 7875 7875 </code></pre>
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 3 rows [63, 85,
107].</code></pre>
<pre><code>[1] 2019
[1] &quot;Unique assetids in matched data: 8629&quot;
[1] &quot;Unique assetids in matched data: 8629&quot;
[1] &quot;Number of treated cells in matched data:&quot;

   0    1 
7981  648 
[1] &quot;Number of treated cells in panel data:&quot;

2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 
 648  648  648  648  648  648  648  648  648  648  648  648  648  648  648  648 
2016 2017 2018 2019 2020 
 648  648  648  648  648 </code></pre>
<pre class="r"><code># Timer
end_time &lt;- Sys.time()

duration &lt;- difftime(end_time, start_time, units=&#39;mins&#39;)
duration</code></pre>
<pre><code>Time difference of 4.252988 mins</code></pre>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 3.6.3 (2020-02-29)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 18.04.6 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas/libblas.so.3
LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.2.20.so

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
 [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
 [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] units_0.8-0     sf_1.0-7        forcats_0.5.1   stringr_1.4.0  
 [5] dplyr_1.0.9     purrr_0.3.4     readr_2.1.2     tidyr_1.2.0    
 [9] tibble_3.1.7    ggplot2_3.3.4   tidyverse_1.3.1

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.8.3       lubridate_1.7.10   class_7.3-20       assertthat_0.2.1  
 [5] rprojroot_2.0.2    digest_0.6.29      utf8_1.2.2         R6_2.5.1          
 [9] cellranger_1.1.0   backports_1.2.1    reprex_2.0.0       e1071_1.7-11      
[13] evaluate_0.14      httr_1.4.3         pillar_1.7.0       rlang_1.0.2       
[17] readxl_1.3.1       rstudioapi_0.13    whisker_0.4        jquerylib_0.1.4   
[21] rmarkdown_2.11     bit_4.0.4          munsell_0.5.0      proxy_0.4-27      
[25] broom_0.7.6        compiler_3.6.3     httpuv_1.6.1       modelr_0.1.8      
[29] xfun_0.24          pkgconfig_2.0.3    htmltools_0.5.2    tidyselect_1.1.2  
[33] workflowr_1.7.0    fansi_1.0.3        crayon_1.5.1       tzdb_0.1.2        
[37] dbplyr_2.1.1       withr_2.4.2        later_1.2.0        grid_3.6.3        
[41] jsonlite_1.8.0     gtable_0.3.0       lifecycle_1.0.1    DBI_1.1.3         
[45] git2r_0.28.0       magrittr_2.0.3     scales_1.1.1       KernSmooth_2.23-20
[49] vroom_1.5.7        cli_3.3.0          stringi_1.7.6      fs_1.5.0          
[53] promises_1.2.0.1   xml2_1.3.3         bslib_0.2.5.1      ellipsis_0.3.2    
[57] generics_0.1.2     vctrs_0.4.1        tools_3.6.3        bit64_4.0.5       
[61] glue_1.6.2         hms_1.1.1          parallel_3.6.3     fastmap_1.1.0     
[65] yaml_2.2.1         colorspace_2.0-1   classInt_0.4-7     rvest_1.0.2       
[69] knitr_1.34         haven_2.3.1        sass_0.4.0        </code></pre>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
https://docs.mathjax.org/en/latest/web/configuration.html. This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
